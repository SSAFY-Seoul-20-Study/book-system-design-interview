유튜브는 우리에게 친숙한 서비스이다. 언뜻 보기엔 간단하다. 그렇기 때문에 유트브 서비스의 그 규모와 복잡성에 대해서 간과하기 쉽다. 유튜브는 일간 50억회의 동영상 재생 요청을 처리하고 있으며, 엄청난 규모로 돈을 벌어들이고 있다.

# 1단계 : 문제 이해 및 설계 범위 확정

- 빠른 비디오 업로드
- 원활한 비디오 재생
- 재생 품질 선택 기능
- 낮은 인프라 비용
- 높은 가용성과 규모 확장성, 그리고 안정성
- 지원 클라이언트: 모바일 앱, 웹브라우저, 그리고 스마트 TV


- 일간 능동 사용자 수 5백만
- 평균 인당 일일 재생 시간 30분
- 최적화 하지 않고 외부 유료 CDN을 이용할 경우 비싼 과금이 발생할 것으로 예상됨


# 2단계 개략적 설계안 제시 및 동의 구하기

유튜브를 설계하기 위해서 중요한 개념은 CDN과 BLOB 스토리지이다.

CDN(콘텐츠 전송 네트워크):  전세계에 분산된 서버를 사용하여 콘텐츠를 더 빠르게 전송하는 기술
BLOB 스토리지: 이진 대형 객체(예: 이미지, 동영상등의 비정형 데이터)를 저장하는 데 사용되는 스토리지 시스템

이런 미디어 서버는 일반적으로 직접 구축하는 것보다 외부 서비스를 이용하는 것이 더 저렴하다. 전문 업체는 규모의 경제와 운영 전문성으로 더욱 효율적으로 서버를 운영하기 때문이다.

따라서 아래와 같은 설계로 서비스를 구성한다.

![image](https://github.com/SSAFY-Seoul-20-Study/book-system-design-interview/assets/118531617/d6a09668-a6d6-4953-b471-aa10d0d90569)

비디오는 CDN에 저장하고, 그 외의 요청은 API 서버가 처리한다.

## 비디오 업로드 절차

### 전체 구조

![image](https://github.com/SSAFY-Seoul-20-Study/book-system-design-interview/assets/118531617/09d57480-5a21-4e9a-8116-348c3a777e6c)

### 비디오 업로드

![image](https://github.com/SSAFY-Seoul-20-Study/book-system-design-interview/assets/118531617/3bc60598-2dea-4573-ab00-21b79750cca5)

### 메타데이터 갱신

![image](https://github.com/SSAFY-Seoul-20-Study/book-system-design-interview/assets/118531617/20aa4d85-e3e7-44d8-bed2-2f5612d8d264)

## 비디오 스트리밍 절차

![image](https://github.com/SSAFY-Seoul-20-Study/book-system-design-interview/assets/118531617/f197e756-c52b-4ab6-9b26-dfecbf2b3f3f)

# 3단계 : 상세 설계

## 비디오 트랜스코딩

비디오 압축 포맷을 다른 형태로 변환하는 작업

- 압축률을 높혀서 저장공간을 아낀다
- 스트리밍 프로토콜에 맞는 비디오 형태로 변환한다
- 네트워크 대역폭에 따라 사용 가능한 여러 버전의 스트림을 준비한다.

인코딩 포맷의 두 가지 요소

- 컨테이터: 비디오, 오디오, 메타데이터의 집합. .avi, .mp4 등의 확장자이다.
- 압축 및 압축 헤제 알고리즘. H.264, HEVC 등이 있다.

## 유향 비순환 그래프 모델



# 4단계 : 마무리

우리는 지금까지 웹소켓을 활용하여 **채팅서버, 접속 상태 서버, 푸시알림 서버, 채팅 내역 저장소, API서버** 등을 구현하였다.
더 추가적으로 아래와 같은 내용들을 구현해보고 이야기 해 볼 수 있다.

- 채팅앱에서 비디오, 이미지등을 제공하기 위해 압축 방식, 클라우드 저장소, 썸네일 생성
- 메시지 암호화
- 캐시
- 로딩 속도 개선
- 오류 처리 (메시지 전송 실패, 재전송 등)
